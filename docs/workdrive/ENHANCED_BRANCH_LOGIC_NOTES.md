# Enhanced Branch Logic Implementation Notes
*–°–æ–∑–¥–∞–Ω–æ: 2025-09-08*

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–ª–∏–∞–ª–æ–≤

### üéØ –ü—Ä–∞–≤–∏–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É):

1. **üöó –ü–æ–∫—É–ø–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π ‚Üí Head Office**
   - VIN –Ω–æ–º–µ—Ä (17 —Å–∏–º–≤–æ–ª–æ–≤)
   - LLM –∫–∞—Ç–µ–≥–æ—Ä–∏—è `CARS`
   - –ê–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–µ –º–∞—Ä–∫–∏ + –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
   - –ê–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ (autohaus, mobile.de)

2. **üå∏ –¶–≤–µ—Ç–æ—á–Ω—ã–π –±–∏–∑–Ω–µ—Å ‚Üí Iris flowers atelier / Wile≈Ñska**
   - **Iris flowers atelier**: DOTYPOSPL, HIBISPOL, –º–∞—Ä–∫–µ—Ä—ã "IRIS FLOWERS - GW005"
   - **Wile≈Ñska**: –º–∞—Ä–∫–µ—Ä—ã "wile≈Ñska", "praga"

3. **üè¢ –ü–æ VAT –ø–æ–∫—É–ø–∞—Ç–µ–ª—è**
   - EE102288270 ‚Üí TaVie Europe O√ú

4. **üè¢ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Üí Head Office**

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- **DOTYPOSPL –ª–∏—Ü–µ–Ω–∑–∏–∏** ‚Üí Iris flowers atelier ‚úÖ
- **–í–æ–¥–∞ —Å –º–∞—Ä–∫–µ—Ä–æ–º "IRIS FLOWERS - GW005"** ‚Üí Iris flowers atelier ‚úÖ  
- **–ü–æ–∫—É–ø–∫–∞ BMW —Å VIN** ‚Üí Head Office ‚úÖ

## üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ Zoho API

### ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã:
- **Zoho –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã** –Ω–æ–º–µ—Ä–æ–≤ Bills –º–µ–∂–¥—É —Ñ–∏–ª–∏–∞–ª–∞–º–∏
- **2 Bills FL/19282/2025** –æ—Ç DOTYPOSPL –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∏–ª–∏–∞–ª–∞—Ö:
  - Branch ID: 281497000000355003
  - Branch ID: 281497000000355063
- **–ö–∞–∂–¥—ã–π Bill –ø—Ä–∏–≤—è–∑–∞–Ω –∫ branch_id**

### üìã –õ–æ–≥–∏–∫–∞ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
- **–ù–ï –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã** –º–µ–∂–¥—É —Ñ–∏–ª–∏–∞–ª–∞–º–∏ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö**
- **–°–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞—Ö

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ BranchManager:
```python
@classmethod
def _is_car_purchase(cls, analysis: Dict) -> bool:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–∫—É–ø–∫—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è"""
    # VIN –Ω–æ–º–µ—Ä, –∫–∞—Ç–µ–≥–æ—Ä–∏—è CARS, –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã

@classmethod  
def _is_flowers_document(cls, analysis: Dict) -> bool:
    """–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ü–≤–µ—Ç–æ—á–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞"""
    # DOTYPOSPL, –º–∞—Ä–∫–µ—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è, HIBISPOL, service markers
```

### –ù–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
```python
# 1. –ü–†–ò–û–†–ò–¢–ï–¢: –ü–æ–∫—É–ø–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π ‚Üí Head Office
if cls._is_car_purchase(analysis):
    return cls.BRANCHES['HEAD_OFFICE']

# 2. –¶–≤–µ—Ç–æ—á–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã ‚Üí Iris flowers / Wile≈Ñska  
if cls._is_flowers_document(analysis):
    return cls._determine_flower_branch(analysis)

# 3. –ü–æ VAT ‚Üí –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
# 4. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Üí Head Office
```

### –ú–∞—Ä–∫–µ—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Ü–≤–µ—Ç–æ—á–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤:
- `iris flowers - gw005` (–≤–æ–¥–∞ –¥–ª—è Iris flowers)
- `iris flowers` (–æ–±—â–∏–π –º–∞—Ä–∫–µ—Ä)
- `browary` (–∞–¥—Ä–µ—Å Iris flowers atelier)
- `wile≈Ñska`, `praga` (–∞–¥—Ä–µ—Å Wile≈Ñska)

## üìä –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏

### DOTYPOSPL (–ª–∏—Ü–µ–Ω–∑–∏–∏):
- **–õ–æ–≥–∏–∫–∞**: –û–±—â–∏–µ –¥–ª—è 2 —Ñ–∏–ª–∏–∞–ª–æ–≤, –Ω–æ —Å—á–µ—Ç –æ–¥–∏–Ω
- **–†–µ—à–µ–Ω–∏–µ**: –û—Ç–Ω–æ—Å–∏–º –∫ Iris flowers atelier
- **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π —Ñ–∏–ª–∏–∞–ª

### –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–æ–≤:
- **–ê—Ä–µ–Ω–¥–∞**: –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º –≤ —Ç–µ–∫—Å—Ç–µ
- **–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏**: –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º —Ç–∏–ø–∞ "IRIS FLOWERS - GW005"
- **–õ–∏—Ü–µ–Ω–∑–∏–∏**: DOTYPOSPL ‚Üí Iris flowers atelier

### –ü–æ–∫—É–ø–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:
- **–í—Å–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏**: Head Office
- **–ö—Ä–∏—Ç–µ—Ä–∏–∏**: VIN, –∫–∞—Ç–µ–≥–æ—Ä–∏—è CARS, –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:
1. **–†–∞—Å—à–∏—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ Branch Manager** —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π** ‚Üí Head Office
3. **–£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ü–≤–µ—Ç–æ—á–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞** —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**

### üîÑ –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏:
1. **–°–æ–∑–¥–∞—Ç—å Bill Duplicate Checker** —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏
2. **–î–æ–±–∞–≤–∏—Ç—å LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ–ø–∏—Å–∞–Ω–∏–π** Bills
3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ WorkDrive Processor**
4. **–°–æ–∑–¥–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞** Bills

## üìù –ó–∞–º–µ—Ç–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è:
1. **DOTYPOSPL ‚Üí Iris flowers atelier** (–æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∏–ª–∏–∞–ª –¥–ª—è –æ–±—â–∏—Ö –ª–∏—Ü–µ–Ω–∑–∏–π)
2. **–ê–≤—Ç–æ–º–æ–±–∏–ª–∏ ‚Üí Head Office** (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏)
3. **–ú–∞—Ä–∫–µ—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è** –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –æ–±—â–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
4. **–î—É–±–ª–∏–∫–∞—Ç—ã –º–µ–∂–¥—É —Ñ–∏–ª–∏–∞–ª–∞–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã** (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏–∫–µ Zoho)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª** –Ω–∞–¥ –æ–±—â–∏–º–∏
- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ª–æ–≥–∏–∫–æ–π

---
*–°–æ–∑–¥–∞–Ω–æ: 2025-09-08*
*–°—Ç–∞—Ç—É—Å: ‚úÖ Enhanced Branch Logic —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞*
*–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: 2 —á–∞—Å–∞*
