# Branch Structure Update Notes
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-09-08 23:45*

## üéØ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∏–ª–∏–∞–ª–æ–≤

### ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:

**–°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- PARKENTERTAINMENT (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- IRIS_FLOWERS (—Ü–≤–µ—Ç–æ—á–Ω—ã–π)
- TAVIE_EUROPE

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- **HEAD_OFFICE** (–≥–ª–∞–≤–Ω—ã–π –æ—Ñ–∏—Å) - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **IRIS_FLOWERS** (–æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω = browary)
- **BROWARY_WILENSKA** (–≤—Ç–æ—Ä–æ–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω = praga)
- **TAVIE_EUROPE** (—ç—Å—Ç–æ–Ω—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è)

## üå∏ –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ—á–Ω—ã—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤

### –ü—Ä–∞–≤–∏–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
1. **Browary Wile≈Ñska** (–≤—Ç–æ—Ä–æ–π –º–∞–≥–∞–∑–∏–Ω):
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: `wile≈Ñska`, `wilenska`, `praga`
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –æ—Å–Ω–æ–≤–Ω—ã–º –º–∞–≥–∞–∑–∏–Ω–æ–º

2. **Iris flowers atelier** (–æ—Å–Ω–æ–≤–Ω–æ–π –º–∞–≥–∞–∑–∏–Ω):
   - HIBISPOL –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤ Wile≈Ñska ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π –º–∞–≥–∞–∑–∏–Ω
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: `iris`, `browary`, `–æ—Å–Ω–æ–≤–Ω–æ–π –º–∞–≥–∞–∑–∏–Ω`
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ü–≤–µ—Ç–æ—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

3. **Head Office** (–≥–ª–∞–≤–Ω—ã–π –æ—Ñ–∏—Å):
   - –í—Å–µ –Ω–µ-—Ü–≤–µ—Ç–æ—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
```python
@classmethod
def _determine_flower_branch(cls, analysis: Dict) -> Optional[str]:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π —Ñ–∏–ª–∏–∞–ª"""
    
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ä–∫–µ—Ä—ã Browary Wile≈Ñska
    wilenska_keywords = ['wile≈Ñska', 'wilenska', 'praga']
    if any(kw in text for kw in wilenska_keywords):
        return 'BROWARY_WILENSKA'
    
    # 2. HIBISPOL –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤ Wile≈Ñska ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π
    if hibispol_supplier and not any(kw in text for kw in wilenska_keywords):
        return 'IRIS_FLOWERS'
    
    # 3. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ü–≤–µ—Ç–æ—á–Ω—ã—Ö ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π
    return 'IRIS_FLOWERS'
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–∏–ª–∏–∞–ª–æ–≤:
```python
BRANCHES = {
    'HEAD_OFFICE': {
        'org_id': '20082562863',
        'name': 'PARKENTERTAINMENT Sp. z o. o.',
        'vat': 'PL5272956146',
        'default_branch': True,
        'description': 'Head Office - –≥–ª–∞–≤–Ω—ã–π –æ—Ñ–∏—Å'
    },
    'IRIS_FLOWERS': {
        'org_id': '20082562863',
        'name': 'Iris flowers atelier',
        'parent_org': 'HEAD_OFFICE',
        'keywords': ['flowers', '—Ü–≤–µ—Ç—ã', '–∫–æ—Ä–æ–±–∫–∏', '–ª–µ–Ω—Ç–æ—á–∫–∏', 'hibispol', 'browary', 'iris'],
        'description': '–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω'
    },
    'BROWARY_WILENSKA': {
        'org_id': '20082562863',
        'name': 'Browary Wile≈Ñska',
        'parent_org': 'HEAD_OFFICE',
        'keywords': ['wile≈Ñska', 'wilenska', 'praga', 'browary', '–≤—Ç–æ—Ä–æ–π –º–∞–≥–∞–∑–∏–Ω'],
        'description': '–í—Ç–æ—Ä–æ–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω (Praga)'
    },
    'TAVIE_EUROPE': {
        'org_id': '20092948714',
        'name': 'TaVie Europe O√ú',
        'vat': 'EE102288270',
        'description': '–≠—Å—Ç–æ–Ω—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è'
    }
}
```

## üß™ –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (5 –Ω–æ–≤—ã—Ö):
1. **test_browary_wilenska_detection_by_wilenska** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ–≤—É "wile≈Ñska"
2. **test_browary_wilenska_detection_by_praga** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ–≤—É "praga"
3. **test_iris_flowers_by_browary_keyword** - –æ—Å–Ω–æ–≤–Ω–æ–π –º–∞–≥–∞–∑–∏–Ω –ø–æ "browary"
4. **test_hibispol_default_to_iris_flowers** - HIBISPOL ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π –º–∞–≥–∞–∑–∏–Ω
5. **test_default_branch_selection** - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è Head Office

### –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤: 18 —Ç–µ—Å—Ç–æ–≤

## üìä –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### Browary Wile≈Ñska (–≤—Ç–æ—Ä–æ–π –º–∞–≥–∞–∑–∏–Ω):
```
üè¢ –ù–∞—á–∞–ª–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–ª–∏–∞–ª–∞
üå∏ –¶–≤–µ—Ç–æ—á–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫: hibispol sp. z o.o.
üå∏ –û–ø—Ä–µ–¥–µ–ª–µ–Ω –≤—Ç–æ—Ä–æ–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω: Browary Wile≈Ñska (–Ω–∞–π–¥–µ–Ω—ã: ['wile≈Ñska'])
üå∏ –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ü–≤–µ—Ç–æ—á–Ω—ã–π —Ñ–∏–ª–∏–∞–ª: Browary Wile≈Ñska
```

### Iris flowers atelier (–æ—Å–Ω–æ–≤–Ω–æ–π –º–∞–≥–∞–∑–∏–Ω):
```
üè¢ –ù–∞—á–∞–ª–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–ª–∏–∞–ª–∞
üå∏ –¶–≤–µ—Ç–æ—á–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫: hibispol sp. z o.o.
üå∏ HIBISPOL –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤ Wile≈Ñska ‚Üí Iris flowers atelier (–æ—Å–Ω–æ–≤–Ω–æ–π)
üå∏ –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ü–≤–µ—Ç–æ—á–Ω—ã–π —Ñ–∏–ª–∏–∞–ª: Iris flowers atelier
```

### Head Office (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
```
üè¢ –ù–∞—á–∞–ª–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–ª–∏–∞–ª–∞
üìã –î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–∞–∫ —Ü–≤–µ—Ç–æ—á–Ω—ã–π
üè¢ –§–∏–ª–∏–∞–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: PARKENTERTAINMENT Sp. z o. o.
```

## üîç –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω–∏–º–∞–Ω–∏—è

### –ò–∑ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. **"Iris flowers atelier —ç—Ç–æ —Ç–æ–∂–µ —Å–∞–º–æ–µ —á—Ç–æ browary"** - –ø–æ–Ω—è—Ç–æ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
2. **"Head Office - —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π branch"** - —Å–¥–µ–ª–∞–Ω —Ñ–∏–ª–∏–∞–ª–æ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
3. **"Browary Wile≈Ñska —ç—Ç–æ –≤—Ç–æ—Ä–æ–π –º–∞–≥–∞–∑–∏–Ω"** - –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∏–ª–∏–∞–ª
4. **"–º–æ–∂–µ—Ç –ø–æ–º–µ—á–∞—Ç—å—Å—è –∫–∞–∫ praga"** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
5. **"–≤—Å–µ —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è —Ü–≤–µ—Ç–æ–≤ - —ç—Ç–æ –∞—Ä–µ–Ω–¥–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤"** - –¥–æ–±–∞–≤–ª–µ–Ω–æ "–∞—Ä–µ–Ω–¥–∞ –º–∞–≥–∞–∑–∏–Ω" –≤ flower_keywords

### –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: wile≈Ñska/praga ‚Üí Browary Wile≈Ñska
- **HIBISPOL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: ‚Üí Iris flowers atelier (–æ—Å–Ω–æ–≤–Ω–æ–π)
- **Fallback**: Head Office –¥–ª—è –Ω–µ-—Ü–≤–µ—Ç–æ—á–Ω—ã—Ö

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:
1. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏–ª–∏–∞–ª–æ–≤** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ü–≤–µ—Ç–æ—á–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
3. **–°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç—ã** –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
4. **–û–±–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### üîÑ –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏:
1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö** –∑–∞ 19 –∞–≤–≥—É—Å—Ç–∞
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å VAT –ª–æ–≥–∏–∫—É** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–ª–æ–≥–∏ –∏ –±—Ä—É—Ç—Ç–æ —Ü–µ–Ω—ã
3. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É Expense** –¥–ª—è —á–µ–∫–æ–≤ PARAGON FISKALNY
4. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ Telegram handlers**

## üìù –ó–∞–º–µ—Ç–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. **–ß–µ—Ç–∫–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è**: wile≈Ñska/praga > hibispol > default
2. **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏
3. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã** –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ
4. **–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
2. **–ê–Ω–∞–ª–∏–∑ –∞–¥—Ä–µ—Å–æ–≤** –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
3. **–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏

---
*–°–æ–∑–¥–∞–Ω–æ: 2025-09-08 23:45*  
*–°—Ç–∞—Ç—É—Å: ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏–ª–∏–∞–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é*  
*–í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: 45 –º–∏–Ω—É—Ç*
